<!DOCTYPE html>
<html>
<head>
  <title>Chat Rooms</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
    }
    input, button {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      font-size: 16px;
    }
    button {
      background-color: #4285f4;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #3367d6;
    }
    #chat-container {
      display: none;
      height: 400px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
    }
    .message {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 4px;
      background-color: #f0f0f0;
    }
    .message .sender {
      font-weight: bold;
      color: #4285f4;
    }
    #room-info {
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Chat Rooms</h1>
    
    <div id="join-panel" class="panel">
      <h2>Join or Create a Room</h2>
      <div>
        <input type="text" id="username" placeholder="Your name" required>
      </div>
      <div>
        <input type="text" id="room-code" placeholder="Room code (leave empty to create new)">
      </div>
      <button id="join-button">Join Room</button>
    </div>
    
    <div id="chat-panel" class="panel" style="display:none">
      <div id="room-info"></div>
      <div id="chat-container"></div>
      <div>
        <input type="text" id="message-input" placeholder="Type your message">
        <button id="send-button">Send</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Client-side code
    document.addEventListener('DOMContentLoaded', () => {
      const joinPanel = document.getElementById('join-panel');
      const chatPanel = document.getElementById('chat-panel');
      const joinButton = document.getElementById('join-button');
      const sendButton = document.getElementById('send-button');
      const usernameInput = document.getElementById('username');
      const roomCodeInput = document.getElementById('room-code');
      const chatContainer = document.getElementById('chat-container');
      const messageInput = document.getElementById('message-input');
      const roomInfo = document.getElementById('room-info');
      
      let socket;
      let currentRoom = '';
      let currentUser = '';
      
      joinButton.addEventListener('click', () => {
        const username = usernameInput.value.trim();
        const roomCode = roomCodeInput.value.trim();
        
        if (!username) {
          alert('Please enter your name');
          return;
        }
        
        currentUser = username;
        
        // Connect to server
        socket = io();
        
        // Set up event listeners
        socket.on('connect', () => {
          console.log('Connected to server');
          
          // Join or create room
          socket.emit('join-room', {
            roomCode,
            username
          });
        });
        
        socket.on('room-joined', (data) => {
          currentRoom = data.roomCode;
          roomInfo.textContent = `Room: ${currentRoom} | Users: ${data.users.join(', ')}`;
          joinPanel.style.display = 'none';
          chatPanel.style.display = 'block';
          messageInput.focus();
        });
        
        socket.on('user-joined', (data) => {
          addMessage(`${data.username} joined the room`);
          roomInfo.textContent = `Room: ${currentRoom} | Users: ${data.users.join(', ')}`;
        });
        
        socket.on('user-left', (data) => {
          addMessage(`${data.username} left the room`);
          roomInfo.textContent = `Room: ${currentRoom} | Users: ${data.users.join(', ')}`;
        });
        
        socket.on('message', (data) => {
          addMessage(`${data.username}: ${data.message}`);
        });
        
        socket.on('error', (message) => {
          alert(message);
        });
      });
      
      sendButton.addEventListener('click', sendMessage);
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      function sendMessage() {
        const message = messageInput.value.trim();
        if (message) {
          socket.emit('send-message', message);
          messageInput.value = '';
        }
      }
      
      function addMessage(text) {
        const messageElement = document.createElement('div');
        messageElement.className = 'message';
        messageElement.innerHTML = text;
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }
    });
  </script>

  <script>
    // Server-side code (using Node.js with Express and Socket.io)
    // Note: This should actually be in a separate server.js file, but included here for completeness
    
    // To run this, you would need to:
    // 1. Create a file called server.js
    // 2. Copy the code below into it
    // 3. Run: npm install express socket.io
    // 4. Run: node server.js
    
    /*
    const express = require('express');
    const http = require('http');
    const socketIo = require('socket.io');
    const path = require('path');
    
    const app = express();
    const server = http.createServer(app);
    const io = socketIo(server);
    
    // Store rooms and their users
    const rooms = new Map();
    
    app.use(express.static(path.join(__dirname, 'public')));
    
    io.on('connection', (socket) => {
      console.log('New client connected');
      
      socket.on('join-room', (data) => {
        const { roomCode, username } = data;
        let roomId = roomCode;
        
        // If no room code provided, create a new room
        if (!roomId) {
          roomId = generateRoomCode();
          rooms.set(roomId, new Set([username]));
        } else {
          // Check if room exists
          if (!rooms.has(roomId)) {
            socket.emit('error', 'Room does not exist');
            return;
          }
          // Add user to existing room
          rooms.get(roomId).add(username);
        }
        
        // Join the room
        socket.join(roomId);
        socket.room = roomId;
        socket.username = username;
        
        // Notify the user who joined
        socket.emit('room-joined', {
          roomCode: roomId,
          users: Array.from(rooms.get(roomId))
        });
        
        // Notify others in the room
        socket.to(roomId).emit('user-joined', {
          username,
          users: Array.from(rooms.get(roomId))
        });
      });
      
      socket.on('send-message', (message) => {
        io.to(socket.room).emit('message', {
          username: socket.username,
          message
        });
      });
      
      socket.on('disconnect', () => {
        if (socket.room && socket.username) {
          const room = rooms.get(socket.room);
          if (room) {
            room.delete(socket.username);
            
            // Notify others in the room
            socket.to(socket.room).emit('user-left', {
              username: socket.username,
              users: Array.from(room)
            });
            
            // Delete room if empty
            if (room.size === 0) {
              rooms.delete(socket.room);
            }
          }
        }
        console.log('Client disconnected');
      });
    });
    
    function generateRoomCode() {
      return Math.random().toString(36).substring(2, 8).toUpperCase();
    }
    
    const PORT = process.env.PORT || 3000;
    server.listen(PORT, () => {
      console.log(`Server running on port ${PORT}`);
    });
    */
  </script>
</body>
</html>
